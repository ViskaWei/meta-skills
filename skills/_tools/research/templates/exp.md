<!--
📝 Agent 书写规范（不出现在正文）:
- Header 全英文
- 正文中文
- 图表文字全英文（中文会乱码）
- 公式用 LaTeX: $inline$ 或 $$block$$

🎯 本模板的目标：
- 前 30 行：读者不仅知道"结论是什么"，还要知道"这是在做什么 & 怎么跑出来的"。
- 正文：读者可以按『实验流程伪代码』复现/重跑。
-->

# 🍃 [实验名称]
> **Name:** [Name]  \
> **ID:** `[PROJECT]-[YYYYMMDD]-[topic]-[##]`  \
> **Topic:** `[topic]` | **MVP:** MVP-X.X | **Project:** `VIT`/`SD`/`BS`  \
> **Author:** [Name] | **Date:** YYYY-MM-DD | **Status:** 🔄 In Progress / ✅ Completed
>
> 🎯 **Target:** [一句话概括实验目的]  \
> 🚀 **Decision / Next:** [实验结论 → 影响什么决策/下一步动作]

---

## ⚡ 核心结论速览（供 main 提取；≤30行；必含 I/O + Pipeline TL;DR）

> **一句话**: [最重要发现 + 关键数字 + 结论性动作（采用/拒绝/待定）]

### 0.1 这实验到底在做什么？（X := 算法/机制 → 目标 | Why+How | I/O | Trade-off）

$$
X := \underbrace{\text{[算法/范式/策略 X]}}_{\text{是什么}}\ \xrightarrow[\text{基于/通过}]{\ \text{[核心机制 🍎]}\ }\ \underbrace{\text{[目标 ⭐]}}_{\text{用于/达到}}\ \big|\ \underbrace{\text{Why 🩸}}_{\text{[痛点]}} + \underbrace{\text{How 💧}}_{\text{[难点]}}
$$
- **🐻 What (是什么) **: [一句话：X 的对象/范式]
- **🍎 核心机制**: [一句话：关键 trick / 关键约束 / 关键结构]
- **⭐ 目标**: [优化什么/验证什么/用于什么决策]
- **🩸 Why（痛点）**: [为什么要做]
- **💧 How（难点）**: [最容易踩坑/最难实现的点]
$$
\underbrace{\text{I/O 🫐}}_{\text{输入→输出}}\ =\ \underbrace{\Delta^+}_{\text{相对基线/替代方案 🍁 的优势 🍀}}\ -\ \underbrace{\Delta^-}_{\text{主要限制/代价 👿}}
$$
**I/O（必须写清楚，读者靠这一段理解实验"在干嘛"）**

| 类型 | 符号 | 说明 | 示例 |
|------|------|------|------|
| **🫐 输入** | $\mathcal{D}$ | 数据集（规模、分布、特征） | 100k 样本 × 1000 特征 |
| **🫐 输入** | $\theta$ | 模型参数/配置 | Ridge α=1.0 |
| **🫐 输出** | $\hat{y}$ | 预测值 | 连续值 / 类别 |
| **📊 指标** | $R^2, MAE$ | 核心指标（≤3 个） | 决定系数 / 平均绝对误差 |
| **🍁 基线** | $f_0$ | 基线模型 | Mean / Linear |
| **🍀 指标Δ** | $\Delta R^2$ | 关注的 trade-off | 精度-复杂度 / 精度-速度 |

### 0.2 Pipeline TL;DR（5-10 行极简伪代码，一眼看懂在跑什么）

> ⚠️ **关键**：核心循环必须写清楚每步的**输出是什么**，用具体数据结构示例说明

```
1. 准备数据：[什么数据集/规模]
2. 构建对比组：[哪些模型/配置]
3. 核心循环：
   for each [模型/配置]:
       for each [fold/epoch]:
           [训练/评估] → 输出: {config, metric1, metric2, ...}
4. 循环后输出：[results 是什么数据结构]
5. 评估：[计算什么指标，对比什么 baseline]
6. 落盘：[输出到哪里]
```

**填写示例（以 Ridge 回归为例）**：
```
1. 准备数据：BOSZ 100k spectra × 1000 wavelengths
2. 构建对比组：Ridge(α=0.1/1/10) / PCA+Ridge / Mean baseline
3. 核心循环：
   for each 模型配置:
       for 5-fold CV:
           fit(X_train, y_train) → eval(X_val, y_val)
           → 单步输出: {'alpha': 1.0, 'fold': 0, 'R2': 0.95, 'MAE': 0.12}
4. 循环后输出：results = [{'alpha':1.0, 'fold':0, 'R2':0.95, ...}, {...}, ...]
5. 评估：计算 mean±std R²/MAE，对比 Mean baseline
6. 落盘：results/[exp_id].json + img/*.png
```

> ⚠️ **复现命令**（repo/entry/config/seed）→ 见 §7.2 附录
> 📖 **详细流程树状图**（完整可视化）→ 见 §2.4.1
> 📖 **详细伪代码**（对齐真实代码）→ 见 §2.4.2

### 0.3 对假设/验证问题的回答

| 验证问题 | 结果 | 结论 |
|---------|------|------|
| Q[X] / H[X.X]: [问题]? | ✅/❌ [关键数值] | [结论 + 决策动作] |

### 0.4 关键数字（只放最重要的 3-5 个）

| Metric | Value | vs Baseline | Notes |
|--------|-------|------------|------|
| [Primary] | | | |
| [Secondary] | | | |
| [Cost/Constraint] | | | |

### 0.5 Links

| Type | Link |
|------|------|
| 🧠 Hub | `experiments/[topic]/[topic]_hub.md` § [Q/H] |
| 🗺️ Roadmap | `experiments/[topic]/[topic]_roadmap.md` § MVP-X.X |
| 📋 Kanban | `status/kanban.md` |

---

# 1. 🎯 目标

**核心问题**: [一句话]

**对应 main / roadmap**:
- 验证问题：Q[X]
- 子假设：H[X.X]
- Gate（如有）：Gate-X

## 1.1 成功标准（验收 / stop rule）

| 场景 | 预期结果 | 判断标准 |
|------|---------|---------|
| ✅ 通过 | [预期范围/方向] | If [条件] → [决策] |
| ❌ 否决 | [触发否决的结果] | If [条件] → [pivot/停止] |
| ⚠️ 异常 | [异常模式] | [先排查什么] |

---

# 2. 🦾 方法（算法 + I/O + 实验流程）

> 📌 **本章至少要填 2.2 I/O 与 2.4 实验流程**；否则读者无法知道实验怎么做的。

## 2.1 算法

> 📌 **结构**：2.1.1 核心算法 → 2.1.2 符号表（变量定义+取值范围）→ 2.1.3 辅助公式（二级计算）

### 2.1.1 核心算法

**[核心算法/公式名称]**：

$$[公式]$$

**直觉解释（2-4 行）**：
- [为什么这样设计]
- [它改变了什么]

### 2.1.2 符号表

> ⚠️ **必填**：核心公式中的每个变量都要在这里定义，包含含义、类型/取值范围、计算方式或来源
> 💡 **关键**：必须给出具体数值例子，让读者秒懂每个变量的实际意义

| 符号 | 含义 | 类型/取值范围 | 计算/来源 | 具体数值例子 |
|------|------|--------------|-----------|-------------|
| $X$ | [变量含义] | [int/float/vector, 范围] | [常量/输入/公式, 见§2.1.3] | 例: `X=42` |
| $Y$ | [变量含义] | [类型, 范围] | [数据来源或公式引用] | 例: `Y=[0.3, 0.7]` |

**符号表填写示例**：

| 符号 | 含义 | 类型/取值范围 | 计算/来源 | 具体数值例子 |
|------|------|--------------|-----------|-------------|
| $N$ | 样本数 | int, $N > 0$ | 数据集 | `N=100000` |
| $d$ | 特征维度 | int, $d > 0$ | 数据集 | `d=1000` |
| $\alpha$ | 正则化系数 | float, $\alpha > 0$ | 超参数 | `α=1.0` |
| $\hat{y}$ | 预测值 | float | 模型输出 | `ŷ=4.52` |

### 2.1.3 辅助公式

> 放置二级计算公式：如相似度计算、归一化等。使读者理解核心公式中每个变量的来源。

**[辅助公式1名称]**：

$$[公式]$$

- **用途**: [这个公式用于计算什么]
- **输入**: [输入变量]
- **输出**: [输出变量，用于核心公式的哪个位置]

**[辅助公式2名称]** (可选):

$$[公式]$$

- **用途**: [...]

## 2.2 输入 / 输出（必填：详细展开，事无巨细）

> ⚠️ **必填**：必须详细展开所有输入输出的细节，包括每个字段的含义、类型、取值范围、单位等。
> 目标：读者不看代码，也能完全知道"喂进去什么 → 吐出来什么"，包括所有细节。

### I/O Schema

| Component | Type/Shape | Example | Notes |
|----------|------------|---------|------|
| Input A | | | |
| Input B | | | |
| Output Y | | | |

### Assumptions & Constraints

| Assumption/Constraint | Why it matters | How handled |
|----------------------|----------------|------------|
| [e.g., i.i.d] | | |
| [e.g., normalized] | | |

## 2.3 实现要点（详细展开，读者能对照代码定位）

> ⚠️ **必填**：必须详细列出所有关键实现点，包括配置解析、数据加载、模型构建、评估等各个环节。

| What | Where (file:function) | Key detail |
|------|------------------------|-----------|
| config parsing | `...` | |
| data loader | `...` | |
| model/policy | `...` | |
| evaluator | `...` | |

> 如果你不想贴真代码，至少给出 **入口脚本 + 关键函数名**。

## 2.4 实验流程（必填：树状可视化 + 模块拆解 + 核心循环展开 + Code Pointer）

> ⚠️ **必填**：本节必须事无巨细地展开每个步骤，让读者完全理解实验是如何执行的。
> 目标：读者看完这一节，（1）能复述实验流水线，（2）能定位代码位置，（3）能理解每个步骤的细节。

### 2.4.1 实验流程树状图（完整可视化）

> 📌 **必填**：用树状结构或方框图完整展示实验流程，包括所有步骤和子步骤
> ⚠️ **关键**：每一步必须备注**输入/输出的具体数值例子**，让读者秒懂数据流
> 
> **两种格式可选**：
> - **树状图**：适合展示层级关系、配置项
> - **方框流程图**：适合展示数据流、明确的输入→输出关系

**格式 A：树状图（展示层级、配置、I/O 示例）**

```
实验流程
│
├── 1. 准备数据
│   ├── 数据源：[具体数据集名称]
│   ├── 规模：[样本数、特征维度等]
│   ├── 预处理：[标准化、划分等]
│   └── 输出: X_train (80k×1000), X_test (20k×1000)
│
├── 2. 构建对比组
│   ├── Baseline: [模型名称 + 关键配置]
│   ├── 实验组: [模型名称 + 关键配置]
│   └── 输出: models = [Ridge(α=1), PCA+Ridge, ...]
│
├── 3. 核心循环 ⭐
│   ├── 外层：对每个模型配置
│   ├── 中层：× K 折交叉验证
│   └── 内层：fit → predict → evaluate
│       ├── Step 1: fit(X_train, y_train)
│       ├── Step 2: y_pred = predict(X_val)
│       ├── Step 3: metrics = evaluate(y_val, y_pred)
│       └── Step 4: 记录 → record = {'config': ..., 'R2': 0.95, ...}
│   └── 循环后输出: results = [record_1, record_2, ...] (共 N_configs × K 条)
│
├── 4. 评估
│   ├── 输入: results (list of dicts)
│   ├── 计算统计量：mean±std for each config
│   └── 输出: summary = {'Ridge_α1': {'R2_mean': 0.95, 'R2_std': 0.02}}
│
└── 5. 落盘
    ├── 结果文件：results/[exp_id].json
    ├── 图表文件：img/[exp_id]_*.png
    └── 输出示例: {"ridge_a1": {"R2": 0.95, ...}, ...}
```

**格式 B：左右两列流程图（推荐，便于可视化生成）**

> 适合系统架构、信息流、模块化流程，左列=步骤名称，右列=详细信息

```
╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                              [流程/架构名称]                                            ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                       ║
║  ┌──────────────────┐     ┌─────────────────────────────────────────────────────┐    ║
║  │ 📂 STEP 1        │     │ • 输入: path = 'data/train.csv'                      │    ║
║  │ 加载数据         │ ─── │ • 输出: X (100k×1000), y (100k,)                     │    ║
║  │                  │     │ • 文件: data/loader.py:load()                        │    ║
║  └────────┬─────────┘     │ • 示例: X.shape = (100000, 1000)                     │    ║
║           │               └─────────────────────────────────────────────────────┘    ║
║           ▼                                                                           ║
║  ┌──────────────────┐     ┌─────────────────────────────────────────────────────┐    ║
║  │ 🔧 STEP 2        │     │ • 输入: X_raw                                        │    ║
║  │ 预处理           │ ─── │ • 输出: X_norm (标准化后)                            │    ║
║  │                  │     │ • 操作: StandardScaler / 去噪 / 划分                 │    ║
║  └────────┬─────────┘     └─────────────────────────────────────────────────────┘    ║
║           │                                                                           ║
║           ▼                                                                           ║
║  ┌──────────────────┐     ┌─────────────────────────────────────────────────────┐    ║
║  │ ⭐ STEP 3        │     │ • 输入: X_train, y_train, config                     │    ║
║  │ 训练循环         │ ─── │ • 单步输出: {'fold':0, 'R2':0.95, 'MAE':0.12}        │    ║
║  │ (核心)           │     │ • 循环输出: results = [{...}, {...}, ...]            │    ║
║  └────────┬─────────┘     │ • 关键: 这是理解实验的核心！                         │    ║
║           │               └─────────────────────────────────────────────────────┘    ║
║           ▼                                                                           ║
║  ┌──────────────────┐     ┌─────────────────────────────────────────────────────┐    ║
║  │ 📊 STEP 4        │     │ • 输入: results (list of dicts)                      │    ║
║  │ 汇总评估         │ ─── │ • 输出: {'R2_mean': 0.95, 'R2_std': 0.02}            │    ║
║  │                  │     │ • 操作: 计算 mean±std，对比 baseline                 │    ║
║  └────────┬─────────┘     └─────────────────────────────────────────────────────┘    ║
║           │                                                                           ║
║           ▼                                                                           ║
║  ┌──────────────────┐     ┌─────────────────────────────────────────────────────┐    ║
║  │ 💾 STEP 5        │     │ • 输入: summary dict                                 │    ║
║  │ 落盘             │ ─── │ • 输出: results/exp_xxx.json + img/*.png             │    ║
║  │                  │     │ • 示例: {"ridge_a1": {"R2": 0.95}, ...}              │    ║
║  └──────────────────┘     └─────────────────────────────────────────────────────┘    ║
║                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝
```

**左右两列绘制规则**：
- 使用 Unicode box-drawing: `┌ ┐ └ ┘ ─ │ ├ ┤ ┬ ┴ ┼ ▼ ▲ ╔ ╗ ╚ ╝ ═ ║`
- **左列**（固定宽度）：图标 + 步骤编号 + 名称 + (角色/层级)
- **右列**（展开详情）：用 `•` 分条列出，必须包含：
  - 输入/输出（具体数据结构示例）
  - 文件/代码位置
  - 关键操作/核心问题
  - 具体示例
- 箭头 `▼` 表示数据/控制流向
- 闭环用 `╰───🔄───╯` 表示回流

**右列内容清单**（根据场景选填）：

| 场景 | 右列必填内容 |
|------|-------------|
| 实验流程 | 输入、输出、数据结构示例、关键操作 |
| 系统架构 | 输入/输出、文件路径、核心职责、示例 |
| 信息流   | 来源→目标、触发条件、产出物 |

**格式 C：简化方框图（备选，适合简单流程）**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        完整训练/评估流程                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────┐                                                       │
│  │  1. 加载数据     │  输入: path = 'data/train.csv'                        │
│  │                  │  输出: X (100k×1000), y (100k,)                       │
│  └────────┬─────────┘                                                       │
│           ▼                                                                 │
│  ┌──────────────────┐                                                       │
│  │  2. 预处理       │  输入: X_raw → 输出: X_norm                           │
│  └────────┬─────────┘                                                       │
│           ▼                                                                 │
│  ┌──────────────────┐                                                       │
│  │  3. 训练循环 ⭐  │  输出: results = [{...}, {...}, ...]                  │
│  └────────┬─────────┘  ← 核心！                                             │
│           ▼                                                                 │
│  ┌──────────────────┐                                                       │
│  │  4. 汇总+落盘    │  输出: results/exp_xxx.json                           │
│  └──────────────────┘                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.4.2 模块拆解（详细展开每个模块，带 Code Pointer）

| Module | Responsibility | Input → Output | Code Pointer |
|--------|----------------|----------------|--------------|
| M1: load_config | 读取配置 | cli → cfg | `scripts/xxx.py:parse_args` |
| M2: load_data | 读取数据 | cfg → data | `data/loader.py:load` |
| M3: build_model | 构建模型 | cfg → model | `models/xxx.py:build` |
| M4: train_loop | **核心循环** | model + data → artifacts | `core/trainer.py:train` |
| M5: evaluate | 计算指标 | artifacts → metrics | `eval/metrics.py:compute` |
| M6: save | 落盘 | metrics → files | `utils/io.py:save` |

> ⚠️ **M4 train_loop 必须展开**：不能只写 `model.fit()`，要写清楚里面在干什么（见 2.4.3）

### 2.4.3 核心循环展开（对齐真实代码的详细伪代码）

> ⚠️ **必填**：必须详细展开核心循环的每一步，包括所有细节。不能只写 `model.fit()`，要让读者不打开代码也能完全理解核心算法是怎么跑的。
> 💡 **关键**：每一步都要标注**输出的具体数据结构**，让读者秒懂 results 是什么

```python
# === 核心循环（对齐 core/trainer.py:train）===

def train_and_eval(models, X, y, cfg):
    """
    输入:
        models: 模型列表 (e.g., [Ridge(α=1), Ridge(α=10), ...])
        X: 特征矩阵 (e.g., shape=(100000, 1000))
        y: 目标向量 (e.g., shape=(100000,))
        cfg: 配置 (e.g., {n_folds: 5, seed: 42})
    
    输出:
        results: list of dict, 每条记录格式如下:
            {'model': 'Ridge', 'alpha': 1.0, 'fold': 0, 'R2': 0.95, 'MAE': 0.12}
    """
    results = []
    kfold = KFold(n_splits=cfg.n_folds, shuffle=True, random_state=cfg.seed)
    
    for model in models:
        for fold, (train_idx, val_idx) in enumerate(kfold.split(X)):
            # Step 1: 划分数据
            X_train, X_val = X[train_idx], X[val_idx]
            y_train, y_val = y[train_idx], y[val_idx]
            
            # Step 2: 训练
            model.fit(X_train, y_train)
            
            # Step 3: 预测
            y_pred = model.predict(X_val)
            
            # Step 4: 评估
            r2 = r2_score(y_val, y_pred)
            mae = mean_absolute_error(y_val, y_pred)
            
            # Step 5: 记录
            record = {
                'model': model.__class__.__name__,
                'alpha': model.alpha,
                'fold': fold,
                'R2': r2,
                'MAE': mae
            }
            results.append(record)
    
    return results
    # 返回: [{'model':'Ridge', 'alpha':1.0, 'fold':0, 'R2':0.95, 'MAE':0.12}, 
    #        {'model':'Ridge', 'alpha':1.0, 'fold':1, 'R2':0.94, 'MAE':0.13}, ...]
    # 共 n_models × n_folds 条记录
```

### 2.4.4 参数扫描（如果有 sweep，必须详细展开）

```python
for setting in grid(cfg.sweep):
    cfg_i = cfg.override(setting)
    run_one(cfg_i)
aggregate_and_compare(all_runs)
```

### 2.4.5 复现清单（必须完整填写）

- [ ] 固定随机性：seed / deterministic flags
- [ ] 固定数据版本：dataset version
- [ ] 固定对照组：baseline 的实现与参数
- [ ] 输出物：metrics.json / results.csv / figs/*.png / logs

---

# 3. 🧪 实验设计（具体到本次实验）

## 3.1 数据 / 环境

| Item | Value |
|------|-------|
| Source | [dataset name + version] |
| Path | `...` |
| Split | Train/Val/Test = N / N / N |
| Feature | dim=N, schema=... |
| Target | [Y 定义] |

## 3.2 Baselines（对照组）

| Baseline | Purpose | Key config |
|----------|---------|-----------|
| B0 | sanity | |
| B1 | SOTA/prev | |

## 3.3 训练 / 运行配置

| Param | Value | Notes |
|------|-------|------|
| epochs / folds | | |
| batch | | |
| lr / alpha | | |
| optimizer | | |
| hardware | | |
| time budget | | |

## 3.4 扫描参数（可选）

| Sweep | Range | Fixed |
|------|-------|-------|
| [param] | [...] | ... |

## 3.5 评价指标

| Metric | Definition | Why |
|--------|------------|-----|
| [primary] | | |
| [secondary] | | |

---

# 4. 📊 图表 & 结果

> ⚠️ 图表文字必须全英文！

### Fig 1: [Title]
![](./img/[filename].png)

**What it shows**: [一句话]

**Key observations**:
- [Obs 1]
- [Obs 2]

---

# 5. 💡 洞见（解释"为什么会这样"）

## 5.1 机制层（Mechanism)

> ⚠️ **必填**：详细解释为什么会得到这样的结果，从机制层面深入分析。

- [机制解释：链接回 2.1/2.2，详细展开]
- [为什么这个机制会导致这个结果]
- [机制的内在逻辑和因果关系]

## 5.2 实验层（Diagnostics)

> ⚠️ **必填**：详细诊断实验结果，排除所有可能的 confounder。

- [排除 confounder：数据/seed/实现差异，详细说明]
- [验证实验设计的合理性]
- [分析可能的偏差来源]

## 5.3 设计层（So what)

> ⚠️ **必填**：详细阐述对系统/产品/研究路线的影响和启示。

- [对系统/产品/研究路线的影响，详细展开]
- [设计原则和最佳实践]
- [适用范围和边界条件]

---

# 6. 📝 结论 & 下一步

## 6.1 核心发现（punch line）
> **[一句话 punch line + 关键数字]**

- ✅/❌ Q[X]/H[X.X]: [结果]
- **Decision**: [采用/拒绝/继续验证]

## 6.2 关键结论（详细展开，不限制条数）

| # | 结论 | 证据（图/表/数字） | 适用范围 |
|---|------|-------------------|---------|
| 1 | | | |
| 2 | | | |

## 6.3 Trade-offs（Δ+ vs Δ-）

| Upside (Δ+) | Cost / Constraint (Δ-) | When acceptable |
|-------------|--------------------------|----------------|
| | | |

## 6.4 下一步（可执行任务）

| Priority | Task | Owner | Link |
|----------|------|-------|------|
| 🔴 P0 | | | |
| 🟡 P1 | | | |

---

# 7. 📎 附录（复现/审计用）

## 7.1 数值结果（全量）

| Config | Metric1 | Metric2 | Notes |
|--------|---------|---------|------|
| | | | |

## 7.2 执行记录（复现命令）

| Item | Value |
|------|-------|
| Repo | `~/[repo]` |
| Script | `scripts/xxx.py` |
| Config | `configs/xxx.yaml` |
| Seed | 42 |
| Output | `results/[exp_id]/` |

```bash
# (1) setup
cd ~/repo
source init.sh

# (2) run
python scripts/xxx.py --config configs/xxx.yaml --seed 42

# (3) eval (if separated)
python scripts/eval.py --input results/[exp_id]/...

# (4) plot
python scripts/plot.py --exp_id [exp_id]
```

## 7.3 运行日志摘要 / Debug（可选）

| Issue | Root cause | Fix |
|------|------------|-----|
| | | |

---

> **实验完成时间**: YYYY-MM-DD
